# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.
# This workflow will build a Java project with Gradle and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-gradle

name: Java CI with Gradle

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

permissions:
  contents: read

jobs:
  test:
    name: Test Repository
    runs-on: ubuntu-latest
    permissions:
      contents: write
#    container: ubuntu:latest
    steps:
    - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
    - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
    - name: Check out repository code
      uses: actions/checkout@v3
    - name: List current directory
      run: |
        pwd
    - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
    - name: List files in the repository ${{ github.workspace }}
      run: |
        ls -la ${{ github.workspace }}
    - name: Github Tag Bump
#      if: github.event.pull_request.merged
      id: tag_version
      uses: anothrNick/github-tag-action@1.64.0
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#      with:
#        github_token: ${{ secrets.GITHUB_TOKEN }}
#        tag_prefix: ${{ inputs.app_tag_prefix }}
    - run: echo Tag Bump ${{ steps.tag_version.outputs.new_tag }}
      shell: bash
    - name: Prepare version
      uses: ./.github/actions/prepare-version
      with:
        release: ${{ github.event.pull_request.merged }}
        tag: ${{ steps.tag_version.outputs.new_tag }}
      id: prepare_version
    - run: echo Publishing version ${{ steps.prepare_version.outputs.version }}
      shell: bash
  build:
    name: Generic CI
    uses: ./.github/workflows/generic-ci-job.yaml

